CREATE DATABASE MOVIE;
USE MOVIE;

CREATE TABLE ACTOR (
    ACT_ID INT(5) PRIMARY KEY,
    ACT_NAME VARCHAR(20),
    ACT_GENDER VARCHAR(5)
);

CREATE TABLE DIRECTOR (
    DIRECTOR_ID INT(5) PRIMARY KEY,
    DIRECTOR_NAME VARCHAR(20),
    DIRECTOR_PHONE DOUBLE
);

CREATE TABLE MOVIES (
    MOV_ID INT(5) PRIMARY KEY,
    MOV_TITLE VARCHAR(20),
    MOV_YEAR INT,
    MOV_LANGUAGE VARCHAR(20),
    DIRECTOR_ID INT(5),
    FOREIGN KEY (DIRECTOR_ID) REFERENCES DIRECTOR(DIRECTOR_ID) ON DELETE CASCADE
);

CREATE TABLE MOVIE_CAST (
    ACT_ID INT(5),
    MOV_ID INT(5),
    ROLE VARCHAR(20),
    PRIMARY KEY (ACT_ID, MOV_ID),
    FOREIGN KEY (ACT_ID) REFERENCES ACTOR(ACT_ID) ON DELETE CASCADE,
    FOREIGN KEY (MOV_ID) REFERENCES MOVIES(MOV_ID) ON DELETE CASCADE
);

CREATE TABLE RATING (
    MOV_ID INT(5) PRIMARY KEY,
    REV_STARS DECIMAL(2,1),
    FOREIGN KEY (MOV_ID) REFERENCES MOVIES(MOV_ID) ON DELETE CASCADE
);

INSERT INTO ACTOR VALUES (01, 'RAJESH', 'M');
INSERT INTO ACTOR VALUES (02, 'AKSHAY', 'M');
INSERT INTO ACTOR VALUES (03, 'AISHWARYA', 'F');
INSERT INTO ACTOR VALUES (04, 'DEEPIKA', 'F');

INSERT INTO DIRECTOR VALUES (100, 'STEVEN SPIELBERG', 89526358536);
INSERT INTO DIRECTOR VALUES (101, 'KARAN', 8952635567);
INSERT INTO DIRECTOR VALUES (103, 'AKTAR', 8952635577);
INSERT INTO DIRECTOR VALUES (104, 'HITCHCOCK', 9952635577);

INSERT INTO MOVIES VALUES (200, 'KNPH', 2000, 'HINDI', 100);
INSERT INTO MOVIES VALUES (201, 'K3G', 2001, 'HINDI', 101);
INSERT INTO MOVIES VALUES (203, 'KIRIK PARTY', 2016, 'KANNADA', 103);
INSERT INTO MOVIES VALUES (204, 'KHAMOSHI', 1994, 'HINDI', 104);

INSERT INTO MOVIE_CAST VALUES (01, 200, 'HERO');
INSERT INTO MOVIE_CAST VALUES (02, 201, 'HERO');
INSERT INTO MOVIE_CAST VALUES (03, 203, 'HEROINE');
INSERT INTO MOVIE_CAST VALUES (04, 204, 'HEROINE');
INSERT INTO MOVIE_CAST VALUES (03, 201, 'HEROINE');
INSERT INTO MOVIE_CAST VALUES (01, 204, 'HERO');

INSERT INTO RATING VALUES (200, 3.5);
INSERT INTO RATING VALUES (201, 1.5);
INSERT INTO RATING VALUES (203, 4);
INSERT INTO RATING VALUES (204, 4.5);

SELECT * FROM ACTOR;
SELECT * FROM DIRECTOR;
SELECT * FROM MOVIES;
SELECT * FROM MOVIE_CAST;
SELECT * FROM RATING;

SELECT MOV_TITLE FROM MOVIES M,DIRECTOR D WHERE M.DIRECTOR_ID=D.DIRECTOR_ID AND 
D.DIRECTOR_NAME ='HITCHCOCK';

SELECT DISTINCT M.MOV_TITLE,C.ACT_ID FROM MOVIES M,MOVIE_CAST C WHERE 
M.MOV_ID=C.MOV_ID AND C.ACT_ID IN(SELECT ACT_ID FROM MOVIE_CAST GROUP BY ACT_ID HAVING 
COUNT(MOV_ID)>1);

SELECT ACT_NAME,MOV_TITLE,MOV_YEAR FROM ACTOR A JOIN MOVIE_CAST C ON A.ACT_ID=C.ACT_ID 
JOIN MOVIES M ON C.MOV_ID =M.MOV_ID WHERE M.MOV_YEAR NOT BETWEEN 2000 AND 2015;

SELECT M.MOV_TITLE,REV_STARS FROM MOVIES M,RATING R WHERE M.MOV_ID=R.MOV_ID AND 
R.REV_STARS>0 ORDER BY MOV_TITLE;

UPDATE RATING SET REV_STARS= 5 WHERE MOV_ID IN(SELECT MOV_ID FROM MOVIES M ,DIRECTOR D 
WHERE D.DIRECTOR_ID=M.DIRECTOR_ID AND DIRECTOR_NAME='STEVEN SPIELBERG');
SELECT * FROM RATING;

CREATE DATABASE ORDERS;
USE ORDERS;

CREATE TABLE SALESMAN (
    SALESMAN_ID INT PRIMARY KEY, 
    NAME VARCHAR(20), 
    CITY VARCHAR(20), 
    COMMISSION VARCHAR(10)
); 

CREATE TABLE CUSTOMER (
    CUSTOMER_ID INT PRIMARY KEY, 
    CUST_NAME VARCHAR(20), 
    CITY VARCHAR(20), 
    GRADE INT(3), 
    SALESMAN_ID INT REFERENCES SALESMAN(SALESMAN_ID) ON DELETE SET NULL
); 

CREATE TABLE ORDERS (
    ORD_NO INT PRIMARY KEY, 
    PURCHASE_AMT FLOAT(10,2), 
    ORD_DATE DATE, 
    CUSTOMER_ID INT REFERENCES CUSTOMER(CUSTOMER_ID) ON DELETE CASCADE, 
    SALESMAN_ID INT REFERENCES SALESMAN(SALESMAN_ID) ON DELETE CASCADE
);

INSERT INTO SALESMAN VALUES (1000, 'KABIR', 'BANGALORE', '25%'); 
INSERT INTO SALESMAN VALUES (2000, 'ALIA', 'MUMBAI', '15%'); 
INSERT INTO SALESMAN VALUES (3000, 'AYAAN', 'JAIPUR', '5%'); 
INSERT INTO SALESMAN VALUES (4000, 'ZARA', 'MANALI', '20%'); 
INSERT INTO SALESMAN VALUES (5000, 'TARA', 'KOLKATA', '30%'); 

INSERT INTO CUSTOMER VALUES (100, 'ELENA', 'BANGALORE', 500, 1000); 
INSERT INTO CUSTOMER VALUES (101, 'SHELDON', 'HYDERABAD', 300, 1000); 
INSERT INTO CUSTOMER VALUES (102, 'PENNY', 'KOLKATA', 800, 5000); 
INSERT INTO CUSTOMER VALUES (103, 'SERENA', 'MANALI', 900, 4000); 
INSERT INTO CUSTOMER VALUES (104, 'CLAY', 'CHENNAI', 500, 4000); 

INSERT INTO ORDERS VALUES (1, 1000.70, '2021-01-04', 100, 1000); 
INSERT INTO ORDERS VALUES (2, 3000.50, '2020-09-28', 101, 1000); 
INSERT INTO ORDERS VALUES (3, 800.70, '2019-12-25', 102, 5000); 
INSERT INTO ORDERS VALUES (4, 700.25, '2018-07-25', 103, 4000); 
INSERT INTO ORDERS VALUES (5, 3000.25, '2017-08-03', 104, 4000);

SELECT * FROM SALESMAN;
SELECT * FROM CUSTOMER;
SELECT * FROM ORDERS;

SELECT GRADE, COUNT(DISTINCT CUSTOMER_ID) 
FROM CUSTOMER 
GROUP BY GRADE 
HAVING GRADE > ( SELECT AVG(GRADE) 
 FROM CUSTOMER 
 WHERE CITY = 'BANGALORE'); 
 
SELECT SALESMAN_ID, NAME 
FROM SALESMAN S 
WHERE 1 < ( SELECT COUNT(*) 
 FROM CUSTOMER 
 WHERE SALESMAN_ID = S.SALESMAN_ID);
 
SELECT DISTINCT S.SALESMAN_ID,S.NAME,'SAME CITY' FROM CUSTOMER 
C,SALESMAN S WHERE 
C.SALESMAN_ID=S.SALESMAN_ID AND C.CITY=S.CITY 
 UNION 
 SELECT DISTINCT 
S.SALESMAN_ID,S.NAME,'DIFFERENT CITY' FROM CUSTOMER C,SALESMAN S 
WHERE 
C.SALESMAN_ID=S.SALESMAN_ID AND C.CITY != S.CITY 
 UNION SELECT DISTINCT S.SALESMAN_ID,S.NAME,'NO 
CUSTOMER' FROM SALESMAN S WHERE SALESMAN_ID NOT IN (SELECT 
SALESMAN_ID FROM CUSTOMER); 

CREATE VIEW HIGHEST AS 
SELECT O.ORD_DATE, S.SALESMAN_ID, S.NAME 
FROM SALESMAN S, ORDERS O 
WHERE S.SALESMAN_ID = O.SALESMAN_ID 
 AND O.PURCHASE_AMT = ( SELECT MAX(PURCHASE_AMT) 
 FROM ORDERS R 
 WHERE R.ORD_DATE = O.ORD_DATE); 
SELECT * FROM HIGHEST; 

DELETE FROM SALESMAN 
WHERE SALESMAN_ID=1000; 
SELECT * FROM SALESMAN; 
